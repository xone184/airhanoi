import{c as _,r as x,j as e,b as R,X as K,d as V,U as B}from"./index-Lu7a-E_e.js";import{P as F}from"./plus-D6jfyUFD.js";import{C as J}from"./clock-D6dwwdqC.js";import{T as X}from"./trash-2-vMZ6cSue.js";import{S as M}from"./sparkles-BI_RB3_m.js";import{G}from"./globe-DI5Js_oc.js";import{L as H,E as Y}from"./loader-2-C7Ay68Yw.js";import{C as Z}from"./chevron-right-Blxaf1g7.js";import{S as ee}from"./send-YDlvu3xr.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=_("GlobeLock",[["path",{d:"M15.686 15A14.5 14.5 0 0 1 12 22a14.5 14.5 0 0 1 0-20 10 10 0 1 0 9.542 13",key:"qkt0x6"}],["path",{d:"M2 12h8.5",key:"ovaggd"}],["path",{d:"M20 6V4a2 2 0 1 0-4 0v2",key:"1of5e8"}],["rect",{width:"8",height:"5",x:"14",y:"6",rx:"1",key:"1fmf51"}]]),se="https://airhanoi.onrender.com/api/chat.php",ne="llama-3.3-70b-versatile",re=async(r,l,h)=>{var w,I,v,u;const n=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:ne,messages:[{role:"system",content:r},{role:"user",content:l}],stream:!0,temperature:.7,max_tokens:1024})});if(!n.ok){const s=await n.text();throw console.error("Groq API error:",n.status,s),new Error(`Groq API lá»—i (${n.status}): ${s}`)}const c=(w=n.body)==null?void 0:w.getReader();if(!c)throw new Error("KhÃ´ng thá»ƒ Ä‘á»c streaming response tá»« Groq.");const g=new TextDecoder;let o="";for(;;){const{done:s,value:a}=await c.read();if(s)break;const z=g.decode(a,{stream:!0}).split(`
`).filter(y=>y.trim()&&y.startsWith("data: "));for(const y of z){const $=y.replace("data: ","").trim();if($!=="[DONE]")try{const j=JSON.parse($),T=((u=(v=(I=j==null?void 0:j.choices)==null?void 0:I[0])==null?void 0:v.delta)==null?void 0:u.content)||"";T&&(o+=T,h&&h(o))}catch{}}}if(!o)throw new Error("Groq tráº£ vá» pháº£n há»“i rá»—ng.");return o},ae=async(r,l="news")=>{var m;const h="https://airhanoi.onrender.com/api/web_search.php";console.log("ğŸ” [WebSearch] Calling API:",h),console.log("ğŸ” [WebSearch] Query:",r,"Type:",l);try{const n=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:r,type:l,max_results:5})});if(console.log("ğŸ” [WebSearch] Response status:",n.status),!n.ok){const o=await n.text();return console.warn("ğŸ” [WebSearch] Failed:",n.status,o),[]}const c=await n.json();console.log("ğŸ” [WebSearch] Raw response:",c);const g=c.success&&((m=c.data)!=null&&m.results)?c.data.results:c.results||[];return console.log("ğŸ” [WebSearch] Parsed results:",g.length,"items"),g}catch(n){return console.error("ğŸ” [WebSearch] Error:",n),[]}},ie=r=>{const l=["tin tá»©c","news","má»›i nháº¥t","hÃ´m nay","gáº§n Ä‘Ã¢y","gáº§n nháº¥t","theo bÃ¡o","cáº­p nháº­t","sá»± kiá»‡n","reddit","internet","thá»i tiáº¿t","dá»± bÃ¡o thá»i tiáº¿t","mÆ°a","náº¯ng","nhiá»‡t Ä‘á»™","bÃ£o","giÃ³","Ä‘á»™ áº©m","khÃ­ háº­u","bá»‡nh","sá»©c khá»e","bá»‡nh viá»‡n","thuá»‘c","Ä‘iá»u trá»‹","y táº¿","phÃ²ng ngá»«a","triá»‡u chá»©ng","thÃ´ng tin","nghiÃªn cá»©u","bÃ¡o cÃ¡o","dá»¯ liá»‡u","theo nghiÃªn cá»©u","chÃ­nh sÃ¡ch","quy Ä‘á»‹nh","luáº­t","biá»‡n phÃ¡p","giáº£i phÃ¡p","so sÃ¡nh","tokyo","beijing","bangkok","tháº¿ giá»›i","quá»‘c táº¿"],h=r.toLowerCase(),m=l.some(n=>h.includes(n));return console.log("ğŸ” [NeedsWebSearch] Query:",r,"Result:",m),m},le=async(r,l,h,m=!0)=>{console.log("ğŸš€ generateAIResponse (Groq) called with question:",r);const n=l.length>0?Math.round(l.reduce((s,a)=>s+a.aqi,0)/l.length):0,c=[...l].sort((s,a)=>a.aqi-s.aqi).slice(0,5),g=[...l].sort((s,a)=>s.aqi-a.aqi).slice(0,5);let o=[],w="";m&&ie(r)&&(console.log("ğŸ” Performing web search for:",r),o=await ae(r,"news"),console.log("ğŸ” Web search returned:",o.length,"results"),o.length>0&&(w=`
ğŸŒ THÃ”NG TIN Tá»ª INTERNET (Nguá»“n tin má»›i nháº¥t):
${o.map((s,a)=>`${a+1}. [${s.title}]
   ğŸ“ ${s.snippet?s.snippet.substring(0,200):"No snippet"}...
   ğŸ”— ${s.url}`).join(`

`)}

âš ï¸ LÆ¯U Ã: Khi sá»­ dá»¥ng thÃ´ng tin tá»« internet, hÃ£y trÃ­ch dáº«n nguá»“n báº±ng cÃ¡ch ghi [Nguá»“n: tÃªn bÃ i viáº¿t].
`));const v=`Báº¡n lÃ  trá»£ lÃ½ AI chuyÃªn gia vá» cháº¥t lÆ°á»£ng khÃ´ng khÃ­ táº¡i HÃ  Ná»™i tÃªn lÃ  "AirHanoi AI".

ğŸ¯ NHIá»†M Vá»¤:
- PhÃ¢n tÃ­ch vÃ  tráº£ lá»i cÃ¢u há»i dá»±a trÃªn Dá»® LIá»†U THá»œI GIAN THá»°C bÃªn dÆ°á»›i
- Náº¿u cÃ³ thÃ´ng tin tá»« internet, hÃ£y tham kháº£o vÃ  trÃ­ch dáº«n nguá»“n
- ÄÆ°a ra lá»i khuyÃªn sá»©c khá»e cá»¥ thá»ƒ, há»¯u Ã­ch
- Tráº£ lá»i báº±ng ngÃ´n ngá»¯ ngÆ°á»i dÃ¹ng sá»­ dá»¥ng (Tiáº¿ng Viá»‡t hoáº·c Tiáº¿ng Anh)

ğŸ“ QUY Táº®C:
- Tráº£ lá»i ngáº¯n gá»n, sÃºc tÃ­ch (tá»‘i Ä‘a 300 tá»«)
- Sá»­ dá»¥ng emoji phÃ¹ há»£p Ä‘á»ƒ dá»… Ä‘á»c
- Æ¯u tiÃªn dá»¯ liá»‡u Ä‘Æ°á»£c cung cáº¥p, khÃ´ng bá»‹a sá»‘ liá»‡u
- Náº¿u Ä‘Æ°á»£c há»i vá» khu vá»±c cá»¥ thá»ƒ, tÃ¬m trong dá»¯ liá»‡u vÃ  tráº£ lá»i chÃ­nh xÃ¡c
- ÄÆ°a ra cáº£nh bÃ¡o sá»©c khá»e khi AQI > 100
- Khi trÃ­ch dáº«n thÃ´ng tin tá»« internet, ghi rÃµ [Nguá»“n: tÃªn nguá»“n]

${`
ğŸ“Š THá»NG KÃŠ Tá»”NG QUAN (${l.length} khu vá»±c):
- AQI trung bÃ¬nh: ${n}
- Má»©c Ä‘á»™: ${n<=50?"Tá»‘t":n<=100?"Trung bÃ¬nh":n<=150?"KÃ©m":n<=200?"Xáº¥u":"Ráº¥t xáº¥u"}

ğŸ”´ TOP 5 Ã” NHIá»„M NHáº¤T:
${c.map((s,a)=>`${a+1}. ${s.district}: AQI ${s.aqi} (${s.pollution_level}), PM2.5: ${s.pm25}Âµg/mÂ³`).join(`
`)}

ğŸŸ¢ TOP 5 Sáº CH NHáº¤T:
${g.map((s,a)=>`${a+1}. ${s.district}: AQI ${s.aqi} (${s.pollution_level}), PM2.5: ${s.pm25}Âµg/mÂ³`).join(`
`)}

ğŸ“‹ CHI TIáº¾T Táº¤T Cáº¢ KHU Vá»°C:
${l.map(s=>`${s.district}: AQI ${s.aqi}, PM2.5: ${s.pm25}, Nhiá»‡t Ä‘á»™: ${s.temperature}Â°C, Äá»™ áº©m: ${s.humidity}%`).join(`
`)}
${w}`}`,u=r;try{const s=await re(v,u,h),a=o.map(b=>({title:b.title,url:b.url}));return console.log("âœ… [generateAIResponse] Returning with",a.length,"sources:",a),{text:s,sources:a}}catch(s){return console.error("Groq Chat Error:",s),{text:`âŒ ÄÃ£ xáº£y ra lá»—i khi káº¿t ná»‘i vá»›i AI: ${(s==null?void 0:s.message)||"Unknown error"}. Vui lÃ²ng thá»­ láº¡i.`}}},E={id:"welcome",role:"model",text:`âš¡ Xin chÃ o! TÃ´i lÃ  AirHanoi AI - trá»£ lÃ½ phÃ¢n tÃ­ch cháº¥t lÆ°á»£ng khÃ´ng khÃ­.

ğŸ” TÃ´i cÃ³ thá»ƒ:
â€¢ PhÃ¢n tÃ­ch AQI theo quáº­n/huyá»‡n
â€¢ So sÃ¡nh má»©c Ä‘á»™ Ã´ nhiá»…m
â€¢ TÃ¬m kiáº¿m tin tá»©c mÃ´i trÆ°á»ng
â€¢ ÄÆ°a ra lá»i khuyÃªn sá»©c khá»e

HÃ£y há»i tÃ´i báº¥t cá»© Ä‘iá»u gÃ¬!`,timestamp:new Date};function q(r){try{return new URL(r).hostname.replace("www.","")}catch{return r}}function oe(r){return`https://www.google.com/s2/favicons?sz=32&domain=${q(r)}`}const be=({data:r})=>{const[l,h]=x.useState([{id:"1",title:"Cuá»™c trÃ² chuyá»‡n má»›i",messages:[{...E,timestamp:new Date}],createdAt:new Date}]),[m,n]=x.useState("1"),[c,g]=x.useState(""),[o,w]=x.useState(!1),[I,v]=x.useState(!1),[u,s]=x.useState(!0),[a,b]=x.useState(!1),z=x.useRef(null),y=x.useRef(null),$=l.find(t=>t.id===m),j=($==null?void 0:$.messages)||[];x.useEffect(()=>{var t;(t=z.current)==null||t.scrollIntoView({behavior:"smooth"})},[j]);const T=x.useCallback((t,i)=>{h(p=>p.map(d=>d.id===t?{...d,messages:i(d.messages)}:d))},[]),W=()=>{const t={id:Date.now().toString(),title:"Cuá»™c trÃ² chuyá»‡n má»›i",messages:[{...E,id:`welcome-${Date.now()}`,timestamp:new Date}],createdAt:new Date};h(i=>[t,...i]),n(t.id),g(""),b(!1)},Q=(t,i)=>{i.stopPropagation(),h(p=>{const d=p.filter(N=>N.id!==t);if(d.length===0){const N={id:Date.now().toString(),title:"Cuá»™c trÃ² chuyá»‡n má»›i",messages:[{...E,id:`welcome-${Date.now()}`,timestamp:new Date}],createdAt:new Date};return n(N.id),[N]}return t===m&&n(d[0].id),d})},L=async()=>{if(!c.trim()||o)return;const t=c.trim(),i=m,p={id:Date.now().toString(),role:"user",text:t,timestamp:new Date},d=(Date.now()+1).toString(),N={id:d,role:"model",text:"",timestamp:new Date};h(k=>k.map(f=>{if(f.id!==i)return f;const S=f.messages.filter(C=>C.role==="user").length===0;return{...f,title:S?t.substring(0,40)+(t.length>40?"...":""):f.title,messages:[...f.messages,p,N]}})),g(""),w(!0),v(!0),y.current&&(y.current.style.height="auto");try{const k=C=>{T(i,A=>A.map(D=>D.id===d?{...D,text:C}:D))},{text:f,sources:S}=await le(t,r,k,u);T(i,C=>C.map(A=>A.id===d?{...A,text:f,sources:S,timestamp:new Date}:A))}catch(k){T(i,f=>f.map(S=>S.id===d?{...S,text:`âŒ Lá»—i: ${(k==null?void 0:k.message)||"Unknown error"}. Vui lÃ²ng thá»­ láº¡i.`}:S))}finally{w(!1),v(!1)}},O=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),L())},P=t=>t.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),U=t=>{const i=new Date().getDate()-t.getDate();return i===0?"HÃ´m nay":i===1?"HÃ´m qua":t.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit"})};return e.jsxs("div",{className:"flex h-screen overflow-hidden bg-slate-950 relative",children:[a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-20 lg:hidden",onClick:()=>b(!1)}),e.jsxs("aside",{className:`
                fixed lg:relative inset-y-0 left-0 z-30 lg:z-auto
                w-64 flex-shrink-0 bg-slate-900 border-r border-slate-800 flex flex-col
                transition-transform duration-300
                ${a?"translate-x-0":"-translate-x-full lg:translate-x-0"}
            `,children:[e.jsxs("div",{className:"p-3 border-b border-slate-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-semibold uppercase tracking-widest px-1",children:[e.jsx(R,{size:12}),"Lá»‹ch sá»­"]}),e.jsx("button",{onClick:()=>b(!1),className:"lg:hidden p-1 text-slate-500 hover:text-white",children:e.jsx(K,{size:16})})]}),e.jsxs("button",{onClick:W,className:"w-full flex items-center justify-center gap-2 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 text-sm rounded-lg transition-colors border border-slate-700",children:[e.jsx(F,{size:14}),"Cuá»™c trÃ² chuyá»‡n má»›i"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:l.map(t=>e.jsxs("button",{onClick:()=>{n(t.id),b(!1)},className:`w-full text-left px-3 py-2.5 rounded-lg text-sm transition-all group flex items-start gap-2 ${t.id===m?"bg-slate-700 text-white":"text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,children:[e.jsx(R,{size:13,className:"mt-0.5 flex-shrink-0 opacity-60"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"truncate text-xs font-medium leading-tight",children:t.title}),e.jsxs("div",{className:"flex items-center gap-1 mt-0.5 text-slate-500 text-[10px]",children:[e.jsx(J,{size:9}),U(t.createdAt)," Â· ",P(t.createdAt)]})]}),e.jsx("button",{onClick:i=>Q(t.id,i),className:"opacity-0 group-hover:opacity-100 p-0.5 hover:text-red-400 transition-all flex-shrink-0",children:e.jsx(X,{size:11})})]},t.id))})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-w-0",children:[e.jsxs("header",{className:"flex-shrink-0 flex items-center justify-between px-3 md:px-5 py-2.5 border-b border-slate-800 bg-slate-900 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("button",{onClick:()=>b(!0),className:"lg:hidden flex-shrink-0 p-1.5 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(V,{size:18})}),e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-600 flex items-center justify-center flex-shrink-0",children:e.jsx(M,{size:14,className:"text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-white font-bold text-sm leading-tight truncate",children:"Trá»£ LÃ½ AI ThÃ´ng Minh"}),e.jsxs("p",{className:"text-slate-500 text-[10px] leading-tight truncate",children:["Groq 3.3 70B",u&&e.jsx("span",{className:"text-emerald-400",children:" â€¢ Web Search"})," â€¢ Äa lÆ°á»£t"]})]})]}),e.jsxs("button",{onClick:()=>s(!u),className:`flex-shrink-0 flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-[11px] font-medium transition-all border ${u?"bg-emerald-500/15 border-emerald-500/40 text-emerald-400":"bg-slate-800 border-slate-700 text-slate-500"}`,children:[u?e.jsx(G,{size:12}):e.jsx(te,{size:12}),e.jsx("span",{className:"hidden sm:inline",children:"Web Search "}),u?"Báº¬T":"Táº®T"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-3 md:px-6 py-4 space-y-4",children:[j.map(t=>{var i;return e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-2 md:gap-3 w-full max-w-[90%] md:max-w-[80%] ${t.role==="user"?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`w-7 h-7 md:w-8 md:h-8 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5 ${t.role==="user"?"bg-blue-600":"bg-emerald-600"}`,children:t.role==="user"?e.jsx(B,{size:13}):e.jsx(M,{size:13})}),e.jsxs("div",{className:"flex flex-col gap-1.5 min-w-0 flex-1",children:[e.jsxs("div",{className:`px-3 py-2.5 md:px-4 md:py-3 rounded-2xl text-sm leading-relaxed whitespace-pre-line break-words ${t.role==="user"?"bg-blue-600 text-white rounded-tr-sm":"bg-slate-800 text-slate-100 rounded-tl-sm border border-slate-700"}`,children:[t.text||e.jsxs("span",{className:"flex items-center gap-2 text-slate-400",children:[e.jsx(H,{className:"animate-spin",size:14}),"Äang suy nghÄ©..."]}),t.role==="model"&&I&&t.id===((i=j[j.length-1])==null?void 0:i.id)&&t.text&&e.jsx("span",{className:"inline-block w-1.5 h-4 bg-emerald-400 ml-1 animate-pulse rounded-sm"})]}),t.role==="model"&&t.sources&&t.sources.length>0&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-emerald-400 bg-emerald-500/10 border border-emerald-500/20 px-2 py-0.5 rounded-full",children:[e.jsx(G,{size:9}),"CÃ³ dÃ¹ng Web Search"]}),e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-slate-400 bg-slate-800 border border-slate-700 px-2 py-0.5 rounded-full",children:[e.jsx(Z,{size:9}),"Nguá»“n tham kháº£o (",t.sources.length,")"]})]}),t.role==="model"&&t.sources&&t.sources.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.sources.map((p,d)=>e.jsxs("a",{href:p.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 px-2.5 py-1.5 bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-xl text-[11px] text-slate-300 hover:text-white transition-all max-w-[160px] md:max-w-[200px]",title:p.title,children:[e.jsx("img",{src:oe(p.url),alt:"",className:"w-3.5 h-3.5 rounded-sm flex-shrink-0",onError:N=>{N.target.style.display="none"}}),e.jsx("span",{className:"truncate",children:q(p.url)}),e.jsx(Y,{size:8,className:"flex-shrink-0 opacity-60"})]},d))}),t.text&&e.jsx("div",{className:`text-[10px] text-slate-600 ${t.role==="user"?"text-right":"text-left"}`,children:P(t.timestamp)})]})]})},t.id)}),e.jsx("div",{ref:z})]}),e.jsxs("div",{className:"flex-shrink-0 px-3 md:px-4 pb-3 pt-2 bg-slate-900 border-t border-slate-800",children:[e.jsxs("div",{className:"relative bg-slate-800 border border-slate-700 rounded-2xl focus-within:border-slate-500 transition-all",children:[e.jsx("textarea",{ref:y,rows:1,className:"w-full bg-transparent text-white text-sm pl-4 pr-12 py-3 resize-none focus:outline-none placeholder-slate-500 max-h-28 overflow-y-auto",placeholder:"Há»i vá» AQI, sá»©c khá»e, dá»± bÃ¡o HÃ  Ná»™i...",value:c,onChange:t=>{g(t.target.value),t.target.style.height="auto",t.target.style.height=Math.min(t.target.scrollHeight,112)+"px"},onKeyDown:O,disabled:o}),e.jsx("button",{onClick:L,disabled:o||!c.trim(),className:"absolute right-2 bottom-2 w-8 h-8 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 text-white rounded-xl flex items-center justify-center transition-all disabled:cursor-not-allowed",children:o?e.jsx(H,{size:14,className:"animate-spin"}):e.jsx(ee,{size:14})})]}),e.jsx("p",{className:"text-center text-[10px] text-slate-600 mt-1.5 hidden sm:block",children:"âš¡ Groq (Llama 3.3 70B) â€¢ Enter Ä‘á»ƒ gá»­i, Shift+Enter Ä‘á»ƒ xuá»‘ng dÃ²ng"})]})]})]})};export{be as default};
