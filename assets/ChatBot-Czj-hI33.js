import{c as U,r as f,j as t,b as G,U as O}from"./index-yOQadGY5.js";import{P as _}from"./plus-D2qe9bzV.js";import{C as K}from"./clock-DZ7o-_QJ.js";import{T as V}from"./trash-2-CLwPCC7y.js";import{S as H}from"./sparkles-B1yK1Usq.js";import{G as M}from"./globe-BlT6cYxV.js";import{L as q,E as B}from"./loader-2-bYu4fyh8.js";import{C as F}from"./chevron-right-B06BIWl4.js";import{S as J}from"./send-Dkvib-SB.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=U("GlobeLock",[["path",{d:"M15.686 15A14.5 14.5 0 0 1 12 22a14.5 14.5 0 0 1 0-20 10 10 0 1 0 9.542 13",key:"qkt0x6"}],["path",{d:"M2 12h8.5",key:"ovaggd"}],["path",{d:"M20 6V4a2 2 0 1 0-4 0v2",key:"1of5e8"}],["rect",{width:"8",height:"5",x:"14",y:"6",rx:"1",key:"1fmf51"}]]),Y="https://airhanoi.onrender.com/api/chat.php",Z="llama-3.3-70b-versatile",ee=async(r,i,d)=>{var w,S,j,x;const n=await fetch(Y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:Z,messages:[{role:"system",content:r},{role:"user",content:i}],stream:!0,temperature:.7,max_tokens:1024})});if(!n.ok){const s=await n.text();throw console.error("Groq API error:",n.status,s),new Error(`Groq API lá»—i (${n.status}): ${s}`)}const c=(w=n.body)==null?void 0:w.getReader();if(!c)throw new Error("KhÃ´ng thá»ƒ Ä‘á»c streaming response tá»« Groq.");const g=new TextDecoder;let l="";for(;;){const{done:s,value:a}=await c.read();if(s)break;const $=g.decode(a,{stream:!0}).split(`
`).filter(b=>b.trim()&&b.startsWith("data: "));for(const b of $){const k=b.replace("data: ","").trim();if(k!=="[DONE]")try{const I=JSON.parse(k),D=((x=(j=(S=I==null?void 0:I.choices)==null?void 0:S[0])==null?void 0:j.delta)==null?void 0:x.content)||"";D&&(l+=D,d&&d(l))}catch{}}}if(!l)throw new Error("Groq tráº£ vá» pháº£n há»“i rá»—ng.");return l},te=async(r,i="news")=>{var m;const d="https://airhanoi.onrender.com/api/web_search.php";console.log("ğŸ” [WebSearch] Calling API:",d),console.log("ğŸ” [WebSearch] Query:",r,"Type:",i);try{const n=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:r,type:i,max_results:5})});if(console.log("ğŸ” [WebSearch] Response status:",n.status),!n.ok){const l=await n.text();return console.warn("ğŸ” [WebSearch] Failed:",n.status,l),[]}const c=await n.json();console.log("ğŸ” [WebSearch] Raw response:",c);const g=c.success&&((m=c.data)!=null&&m.results)?c.data.results:c.results||[];return console.log("ğŸ” [WebSearch] Parsed results:",g.length,"items"),g}catch(n){return console.error("ğŸ” [WebSearch] Error:",n),[]}},se=r=>{const i=["tin tá»©c","news","má»›i nháº¥t","hÃ´m nay","gáº§n Ä‘Ã¢y","gáº§n nháº¥t","theo bÃ¡o","cáº­p nháº­t","sá»± kiá»‡n","reddit","internet","thá»i tiáº¿t","dá»± bÃ¡o thá»i tiáº¿t","mÆ°a","náº¯ng","nhiá»‡t Ä‘á»™","bÃ£o","giÃ³","Ä‘á»™ áº©m","khÃ­ háº­u","bá»‡nh","sá»©c khá»e","bá»‡nh viá»‡n","thuá»‘c","Ä‘iá»u trá»‹","y táº¿","phÃ²ng ngá»«a","triá»‡u chá»©ng","thÃ´ng tin","nghiÃªn cá»©u","bÃ¡o cÃ¡o","dá»¯ liá»‡u","theo nghiÃªn cá»©u","chÃ­nh sÃ¡ch","quy Ä‘á»‹nh","luáº­t","biá»‡n phÃ¡p","giáº£i phÃ¡p","so sÃ¡nh","tokyo","beijing","bangkok","tháº¿ giá»›i","quá»‘c táº¿"],d=r.toLowerCase(),m=i.some(n=>d.includes(n));return console.log("ğŸ” [NeedsWebSearch] Query:",r,"Result:",m),m},ne=async(r,i,d,m=!0)=>{console.log("ğŸš€ generateAIResponse (Groq) called with question:",r);const n=i.length>0?Math.round(i.reduce((s,a)=>s+a.aqi,0)/i.length):0,c=[...i].sort((s,a)=>a.aqi-s.aqi).slice(0,5),g=[...i].sort((s,a)=>s.aqi-a.aqi).slice(0,5);let l=[],w="";m&&se(r)&&(console.log("ğŸ” Performing web search for:",r),l=await te(r,"news"),console.log("ğŸ” Web search returned:",l.length,"results"),l.length>0&&(w=`
ğŸŒ THÃ”NG TIN Tá»ª INTERNET (Nguá»“n tin má»›i nháº¥t):
${l.map((s,a)=>`${a+1}. [${s.title}]
   ğŸ“ ${s.snippet?s.snippet.substring(0,200):"No snippet"}...
   ğŸ”— ${s.url}`).join(`

`)}

âš ï¸ LÆ¯U Ã: Khi sá»­ dá»¥ng thÃ´ng tin tá»« internet, hÃ£y trÃ­ch dáº«n nguá»“n báº±ng cÃ¡ch ghi [Nguá»“n: tÃªn bÃ i viáº¿t].
`));const j=`Báº¡n lÃ  trá»£ lÃ½ AI chuyÃªn gia vá» cháº¥t lÆ°á»£ng khÃ´ng khÃ­ táº¡i HÃ  Ná»™i tÃªn lÃ  "AirHanoi AI".

ğŸ¯ NHIá»†M Vá»¤:
- PhÃ¢n tÃ­ch vÃ  tráº£ lá»i cÃ¢u há»i dá»±a trÃªn Dá»® LIá»†U THá»œI GIAN THá»°C bÃªn dÆ°á»›i
- Náº¿u cÃ³ thÃ´ng tin tá»« internet, hÃ£y tham kháº£o vÃ  trÃ­ch dáº«n nguá»“n
- ÄÆ°a ra lá»i khuyÃªn sá»©c khá»e cá»¥ thá»ƒ, há»¯u Ã­ch
- Tráº£ lá»i báº±ng ngÃ´n ngá»¯ ngÆ°á»i dÃ¹ng sá»­ dá»¥ng (Tiáº¿ng Viá»‡t hoáº·c Tiáº¿ng Anh)

ğŸ“ QUY Táº®C:
- Tráº£ lá»i ngáº¯n gá»n, sÃºc tÃ­ch (tá»‘i Ä‘a 300 tá»«)
- Sá»­ dá»¥ng emoji phÃ¹ há»£p Ä‘á»ƒ dá»… Ä‘á»c
- Æ¯u tiÃªn dá»¯ liá»‡u Ä‘Æ°á»£c cung cáº¥p, khÃ´ng bá»‹a sá»‘ liá»‡u
- Náº¿u Ä‘Æ°á»£c há»i vá» khu vá»±c cá»¥ thá»ƒ, tÃ¬m trong dá»¯ liá»‡u vÃ  tráº£ lá»i chÃ­nh xÃ¡c
- ÄÆ°a ra cáº£nh bÃ¡o sá»©c khá»e khi AQI > 100
- Khi trÃ­ch dáº«n thÃ´ng tin tá»« internet, ghi rÃµ [Nguá»“n: tÃªn nguá»“n]

${`
ğŸ“Š THá»NG KÃŠ Tá»”NG QUAN (${i.length} khu vá»±c):
- AQI trung bÃ¬nh: ${n}
- Má»©c Ä‘á»™: ${n<=50?"Tá»‘t":n<=100?"Trung bÃ¬nh":n<=150?"KÃ©m":n<=200?"Xáº¥u":"Ráº¥t xáº¥u"}

ğŸ”´ TOP 5 Ã” NHIá»„M NHáº¤T:
${c.map((s,a)=>`${a+1}. ${s.district}: AQI ${s.aqi} (${s.pollution_level}), PM2.5: ${s.pm25}Âµg/mÂ³`).join(`
`)}

ğŸŸ¢ TOP 5 Sáº CH NHáº¤T:
${g.map((s,a)=>`${a+1}. ${s.district}: AQI ${s.aqi} (${s.pollution_level}), PM2.5: ${s.pm25}Âµg/mÂ³`).join(`
`)}

ğŸ“‹ CHI TIáº¾T Táº¤T Cáº¢ KHU Vá»°C:
${i.map(s=>`${s.district}: AQI ${s.aqi}, PM2.5: ${s.pm25}, Nhiá»‡t Ä‘á»™: ${s.temperature}Â°C, Äá»™ áº©m: ${s.humidity}%`).join(`
`)}
${w}`}`,x=r;try{const s=await ee(j,x,d),a=l.map(T=>({title:T.title,url:T.url}));return console.log("âœ… [generateAIResponse] Returning with",a.length,"sources:",a),{text:s,sources:a}}catch(s){return console.error("Groq Chat Error:",s),{text:`âŒ ÄÃ£ xáº£y ra lá»—i khi káº¿t ná»‘i vá»›i AI: ${(s==null?void 0:s.message)||"Unknown error"}. Vui lÃ²ng thá»­ láº¡i.`}}},L={id:"welcome",role:"model",text:`âš¡ Xin chÃ o! TÃ´i lÃ  **AirHanoi AI** - trá»£ lÃ½ phÃ¢n tÃ­ch cháº¥t lÆ°á»£ng khÃ´ng khÃ­.

ğŸ” TÃ´i cÃ³ thá»ƒ:
â€¢ PhÃ¢n tÃ­ch AQI theo quáº­n/huyá»‡n
â€¢ So sÃ¡nh má»©c Ä‘á»™ Ã´ nhiá»…m
â€¢ TÃ¬m kiáº¿m tin tá»©c mÃ´i trÆ°á»ng
â€¢ ÄÆ°a ra lá»i khuyÃªn sá»©c khá»e

HÃ£y há»i tÃ´i báº¥t cá»© Ä‘iá»u gÃ¬!`,timestamp:new Date};function W(r){try{return new URL(r).hostname.replace("www.","")}catch{return r}}function re(r){return`https://www.google.com/s2/favicons?sz=32&domain=${W(r)}`}const xe=({data:r})=>{const[i,d]=f.useState([{id:"1",title:"Cuá»™c trÃ² chuyá»‡n má»›i",messages:[{...L,timestamp:new Date}],createdAt:new Date}]),[m,n]=f.useState("1"),[c,g]=f.useState(""),[l,w]=f.useState(!1),[S,j]=f.useState(!1),[x,s]=f.useState(!0),a=f.useRef(null),T=f.useRef(null),$=i.find(e=>e.id===m),b=($==null?void 0:$.messages)||[];f.useEffect(()=>{var e;(e=a.current)==null||e.scrollIntoView({behavior:"smooth"})},[b]);const k=f.useCallback((e,o)=>{d(u=>u.map(h=>h.id===e?{...h,messages:o(h.messages)}:h))},[]),I=()=>{const e={id:Date.now().toString(),title:"Cuá»™c trÃ² chuyá»‡n má»›i",messages:[{...L,id:`welcome-${Date.now()}`,timestamp:new Date}],createdAt:new Date};d(o=>[e,...o]),n(e.id),g("")},D=(e,o)=>{o.stopPropagation(),d(u=>{const h=u.filter(y=>y.id!==e);if(h.length===0){const y={id:Date.now().toString(),title:"Cuá»™c trÃ² chuyá»‡n má»›i",messages:[{...L,id:`welcome-${Date.now()}`,timestamp:new Date}],createdAt:new Date};return n(y.id),[y]}return e===m&&n(h[0].id),h})},P=async()=>{if(!c.trim()||l)return;const e=c.trim(),o=m,u={id:Date.now().toString(),role:"user",text:e,timestamp:new Date},h=(Date.now()+1).toString(),y={id:h,role:"model",text:"",timestamp:new Date};d(N=>N.map(p=>{if(p.id!==o)return p;const v=p.messages.filter(C=>C.role==="user").length===0;return{...p,title:v?e.substring(0,40)+(e.length>40?"...":""):p.title,messages:[...p.messages,u,y]}})),g(""),w(!0),j(!0);try{const N=C=>{k(o,A=>A.map(E=>E.id===h?{...E,text:C}:E))},{text:p,sources:v}=await ne(e,r,N,x);k(o,C=>C.map(A=>A.id===h?{...A,text:p,sources:v,timestamp:new Date}:A))}catch(N){k(o,p=>p.map(v=>v.id===h?{...v,text:`âŒ ÄÃ£ xáº£y ra lá»—i: ${(N==null?void 0:N.message)||"Unknown error"}. Vui lÃ²ng thá»­ láº¡i.`}:v))}finally{w(!1),j(!1)}},z=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),P())},R=e=>e.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),Q=e=>{const u=new Date().getDate()-e.getDate();return u===0?"HÃ´m nay":u===1?"HÃ´m qua":e.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit"})};return t.jsxs("div",{className:"flex h-screen overflow-hidden bg-slate-950",children:[t.jsxs("aside",{className:"w-64 flex-shrink-0 bg-slate-900 border-r border-slate-800 flex flex-col",children:[t.jsxs("div",{className:"p-3 border-b border-slate-800",children:[t.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-semibold uppercase tracking-widest px-1 mb-2",children:[t.jsx(G,{size:12}),"Lá»‹ch sá»­ trÃ² chuyá»‡n"]}),t.jsxs("button",{onClick:I,className:"w-full flex items-center justify-center gap-2 py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 text-sm rounded-lg transition-colors border border-slate-700",children:[t.jsx(_,{size:14}),"Cuá»™c trÃ² chuyá»‡n má»›i"]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1",children:i.map(e=>t.jsxs("button",{onClick:()=>n(e.id),className:`w-full text-left px-3 py-2.5 rounded-lg text-sm transition-all group flex items-start gap-2 ${e.id===m?"bg-slate-700 text-white":"text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,children:[t.jsx(G,{size:13,className:"mt-0.5 flex-shrink-0 opacity-60"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"truncate text-xs font-medium leading-tight",children:e.title}),t.jsxs("div",{className:"flex items-center gap-1 mt-0.5 text-slate-500 text-[10px]",children:[t.jsx(K,{size:9}),Q(e.createdAt)," Â· ",R(e.createdAt)]})]}),t.jsx("button",{onClick:o=>D(e.id,o),className:"opacity-0 group-hover:opacity-100 p-0.5 hover:text-red-400 transition-all flex-shrink-0",title:"XÃ³a cuá»™c trÃ² chuyá»‡n",children:t.jsx(V,{size:11})})]},e.id))})]}),t.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[t.jsxs("header",{className:"flex-shrink-0 flex items-center justify-between px-5 py-3 border-b border-slate-800 bg-slate-900",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-600 flex items-center justify-center",children:t.jsx(H,{size:16,className:"text-white"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-white font-bold text-base flex items-center gap-2",children:"Trá»£ LÃ½ AI ThÃ´ng Minh"}),t.jsxs("p",{className:"text-slate-500 text-[11px]",children:["Groq Llama 3.3 70B",x&&t.jsxs("span",{children:[" â€¢ ",t.jsx("span",{className:"text-emerald-400",children:"Web Search"})]})," â€¢ ","Äa lÆ°á»£t"]})]})]}),t.jsxs("button",{onClick:()=>s(!x),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-all border ${x?"bg-emerald-500/15 border-emerald-500/40 text-emerald-400 hover:bg-emerald-500/25":"bg-slate-800 border-slate-700 text-slate-500 hover:bg-slate-700 hover:text-slate-300"}`,title:x?"Táº¯t Web Search":"Báº­t Web Search",children:[x?t.jsx(M,{size:13}):t.jsx(X,{size:13}),"Web Search ",x?"Báº¬T":"Táº®T"]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-5 space-y-5",children:[b.map(e=>{var o;return t.jsx("div",{className:`flex ${e.role==="user"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`flex gap-3 max-w-[80%] ${e.role==="user"?"flex-row-reverse":"flex-row"}`,children:[t.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 mt-0.5 ${e.role==="user"?"bg-blue-600":"bg-emerald-600"}`,children:e.role==="user"?t.jsx(O,{size:15}):t.jsx(H,{size:15})}),t.jsxs("div",{className:"flex flex-col gap-2 min-w-0",children:[t.jsxs("div",{className:`px-4 py-3 rounded-2xl text-sm leading-relaxed whitespace-pre-line ${e.role==="user"?"bg-blue-600 text-white rounded-tr-sm":"bg-slate-800 text-slate-100 rounded-tl-sm border border-slate-700"}`,children:[e.text||t.jsxs("span",{className:"flex items-center gap-2 text-slate-400",children:[t.jsx(q,{className:"animate-spin",size:14}),"Äang suy nghÄ©..."]}),e.role==="model"&&S&&e.id===((o=b[b.length-1])==null?void 0:o.id)&&e.text&&t.jsx("span",{className:"inline-block w-1.5 h-4 bg-emerald-400 ml-1 animate-pulse rounded-sm"})]}),e.role==="model"&&e.sources&&e.sources.length>0&&t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsxs("span",{className:"flex items-center gap-1 text-[11px] text-emerald-400 bg-emerald-500/10 border border-emerald-500/20 px-2 py-1 rounded-full",children:[t.jsx(M,{size:10}),"CÃ³ dÃ¹ng Web Search"]}),t.jsxs("span",{className:"flex items-center gap-1 text-[11px] text-slate-400 bg-slate-800 border border-slate-700 px-2 py-1 rounded-full cursor-pointer hover:bg-slate-700 transition-colors",children:[t.jsx(F,{size:10}),"Nguá»“n tham kháº£o (",e.sources.length,")"]})]}),e.role==="model"&&e.sources&&e.sources.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:e.sources.map((u,h)=>t.jsxs("a",{href:u.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-700 hover:border-slate-600 rounded-xl text-xs text-slate-300 hover:text-white transition-all max-w-[200px] group",title:u.title,children:[t.jsx("img",{src:re(u.url),alt:"",className:"w-4 h-4 rounded-sm flex-shrink-0",onError:y=>{y.target.style.display="none"}}),t.jsx("span",{className:"truncate",children:W(u.url)}),t.jsx(B,{size:9,className:"flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})]},h))}),e.text&&t.jsx("div",{className:`text-[10px] text-slate-600 ${e.role==="user"?"text-right":"text-left"}`,children:R(e.timestamp)})]})]})},e.id)}),t.jsx("div",{ref:a})]}),t.jsxs("div",{className:"flex-shrink-0 px-4 pb-4 pt-2 bg-slate-900 border-t border-slate-800",children:[t.jsxs("div",{className:"relative bg-slate-800 border border-slate-700 rounded-2xl focus-within:border-slate-500 transition-all",children:[t.jsx("textarea",{ref:T,rows:1,className:"w-full bg-transparent text-white text-sm pl-4 pr-12 py-3.5 resize-none focus:outline-none placeholder-slate-500 max-h-36 overflow-y-auto",placeholder:"Há»i vá» AQI, sá»©c khá»e, dá»± bÃ¡o HÃ  Ná»™i...",value:c,onChange:e=>{g(e.target.value),e.target.style.height="auto",e.target.style.height=Math.min(e.target.scrollHeight,144)+"px"},onKeyDown:z,disabled:l}),t.jsx("button",{onClick:P,disabled:l||!c.trim(),className:"absolute right-2.5 bottom-2.5 w-8 h-8 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 text-white rounded-xl flex items-center justify-center transition-all disabled:cursor-not-allowed",children:l?t.jsx(q,{size:14,className:"animate-spin"}):t.jsx(J,{size:14})})]}),t.jsx("p",{className:"text-center text-[10px] text-slate-600 mt-2",children:"âš¡ Groq (Llama 3.3 70B) â€¢ Ultra Fast Â· Enter Ä‘á»ƒ gá»­i, Shift+Enter Ä‘á»ƒ xuá»‘ng dÃ²ng"})]})]})]})};export{xe as default};
