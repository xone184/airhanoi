import{c as F,r as a,j as e,X as V,U as C,h as b,A as K}from"./index-CM8NZD4X.js";import{G as $}from"./globe-CGWlF0Np.js";import{R as E}from"./refresh-cw-CcJAmflI.js";import{L as T,E as L}from"./loader-2-D3ak9EIy.js";import{A as R}from"./alert-triangle-C1mDMTYK.js";import{C as p}from"./calendar-DTzQMFPp.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=F("Rss",[["path",{d:"M4 11a9 9 0 0 1 9 9",key:"pv89mb"}],["path",{d:"M4 4a16 16 0 0 1 16 16",key:"k0647b"}],["circle",{cx:"5",cy:"19",r:"1",key:"bfqh0e"}]]),H=()=>{const[r,A]=a.useState([]),[j,w]=a.useState(!0),[l,c]=a.useState(null),[o,v]=a.useState(""),[x,n]=a.useState("idle"),[N,m]=a.useState(null),[y,U]=a.useState(null),[u,k]=a.useState(!1),h=async(t=!1)=>{t?k(!0):w(!0),m(null);try{if(!t)try{const d=await b.refreshNews();d.success&&d.data&&console.log(`Fetched ${d.data.inserted} new articles from external sources`)}catch(d){console.warn("Could not fetch external news:",d)}const s=await b.getNews();if(s.success&&s.data)A(s.data),U(new Date),s.data.length===0&&m("Không có tin tức nào. Vui lòng thử cập nhật từ trang Admin.");else throw new Error(s.error||"Failed to fetch news")}catch(s){m(s.message||"Could not fetch news."),console.error(s)}finally{w(!1),k(!1)}};a.useEffect(()=>{h();const t=setInterval(()=>{h(!0)},3e5);return()=>{clearInterval(t)}},[]);const[g,z]=a.useState(!1),[S,i]=a.useState(""),I=async()=>{var t;if(!o.trim()||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)){n("error"),i("Email không hợp lệ");return}z(!0),n("idle"),i("");try{const s=await b.subscribeNewsletter(o.trim());s.success?(n("success"),i(((t=s.data)==null?void 0:t.message)||"Đăng ký thành công!"),v(""),setTimeout(()=>{n("idle"),i("")},5e3)):(n("error"),i(s.error||"Không thể đăng ký. Vui lòng thử lại."))}catch(s){n("error"),i(s.message||"Đã xảy ra lỗi. Vui lòng thử lại.")}finally{z(!1)}},M=()=>j?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(T,{className:"animate-spin text-blue-500",size:40}),e.jsx("span",{className:"ml-3 text-slate-400",children:"Đang cập nhật tin tức mới nhất..."})]}):N?e.jsxs("div",{className:"text-center p-8 bg-slate-800/50 rounded-xl",children:[e.jsx(R,{className:"mx-auto text-red-500 mb-4",size:40}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Lỗi khi tải tin tức"}),e.jsx("p",{className:"text-slate-400 mb-6",children:N}),e.jsxs("button",{onClick:()=>h(),className:"bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center gap-2 mx-auto",children:[e.jsx(E,{size:16}),"Thử lại"]})]}):r.length===0?e.jsxs("div",{className:"text-center p-8 bg-slate-800/50 rounded-xl",children:[e.jsx(f,{className:"mx-auto text-slate-500 mb-4",size:40}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Chưa có tin tức"}),e.jsx("p",{className:"text-slate-400 mb-6",children:"Hiện không có bài viết nào. Admin có thể cần phải cập nhật tin tức từ nguồn ngoài."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{onClick:()=>c(r[0]),className:"mb-10 relative rounded-3xl overflow-hidden group cursor-pointer shadow-2xl h-[400px] border border-slate-700/50",children:[e.jsx("img",{src:r[0].imageUrl,alt:r[0].title,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-900/60 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 p-8 lg:p-10 max-w-3xl",children:[e.jsx("span",{className:"px-3 py-1 bg-red-600 text-white text-xs font-bold rounded-full uppercase tracking-wider mb-4 inline-block shadow-lg text-invariant-white",children:"Mới nhất"}),e.jsx("h2",{className:"text-2xl lg:text-4xl font-bold text-white mb-4 leading-tight group-hover:text-blue-400 transition-colors text-invariant-white shadow-sm",children:r[0].title}),e.jsx("p",{className:"text-slate-200 text-base lg:text-lg mb-4 line-clamp-2 text-invariant-white",children:r[0].summary}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-slate-300 text-invariant-white",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(C,{size:16})," ",r[0].author]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(p,{size:16})," ",r[0].date]})]})]})]}),e.jsxs("h3",{className:"text-xl font-bold text-white mb-6 border-l-4 border-blue-500 pl-3 flex items-center gap-2",children:[e.jsx(f,{size:20,className:"text-blue-500"})," Tin Nổi Bật Khác"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.slice(1).map(t=>e.jsxs("div",{onClick:()=>c(t),className:"glass-panel rounded-2xl overflow-hidden hover:-translate-y-2 transition-transform duration-300 group shadow-lg flex flex-col cursor-pointer",children:[e.jsxs("div",{className:"h-48 overflow-hidden relative",children:[e.jsx("img",{src:t.imageUrl,alt:t.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded-full uppercase shadow-md text-invariant-white
                                        ${t.category==="event"?"bg-purple-600 text-white":t.category==="tips"?"bg-green-600 text-white":"bg-blue-600 text-white"}`,children:t.category==="event"?"Sự kiện":t.category==="tips"?"Mẹo vặt":"Tin tức"})})]}),e.jsxs("div",{className:"p-6 flex-1 flex flex-col",children:[e.jsx("h4",{className:"text-lg font-bold text-white mb-3 group-hover:text-blue-400 transition-colors line-clamp-2",children:t.title}),e.jsx("p",{className:"text-slate-400 text-sm mb-4 line-clamp-3 flex-1 break-words",children:t.summary}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-700 pt-4 mt-auto",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(p,{size:14})," ",t.date]}),e.jsx("span",{className:"text-[10px] text-slate-600 mt-0.5",children:t.author})]}),e.jsxs("button",{className:"text-blue-400 text-sm font-bold flex items-center gap-1 group-hover:gap-2 transition-all",children:["Đọc tiếp ",e.jsx(K,{size:16})]})]})]})]},t.id))})]});return e.jsxs("div",{className:"p-6 lg:p-10 animate-fade-in h-full overflow-y-auto pb-20 relative",children:[e.jsxs("header",{className:"mb-8 flex flex-col md:flex-row justify-between md:items-end gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Tin Tức & Sự Kiện"}),e.jsxs("p",{className:"text-slate-400 flex items-center gap-2",children:[e.jsx($,{size:14})," Tổng hợp từ các nguồn uy tín",y&&e.jsxs("span",{className:"text-xs text-slate-500 ml-2",children:["• Cập nhật lúc ",y.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("button",{onClick:()=>h(!1),disabled:j||u,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 disabled:cursor-not-allowed text-white text-invariant-white rounded-lg font-semibold transition-colors shadow-lg",title:"Cập nhật tin tức mới",children:[e.jsx(E,{size:18,className:u?"animate-spin":""}),e.jsx("span",{children:u?"Đang cập nhật...":"Làm mới"})]})]}),M(),e.jsxs("div",{className:"mt-12 bg-gradient-to-r from-blue-900 to-slate-900 rounded-2xl p-8 border border-blue-500/30 flex flex-col md:flex-row items-center justify-between gap-6 shadow-2xl",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-white mb-2 text-invariant-white flex items-center gap-2",children:[e.jsx(f,{className:"text-blue-400",size:24}),"Đăng ký nhận bản tin môi trường"]}),e.jsx("p",{className:"text-blue-200",children:"Nhận thông tin cập nhật hàng tuần về chất lượng không khí và sự kiện xanh."})]}),e.jsxs("div",{className:"flex flex-col w-full md:w-auto gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",placeholder:"Email của bạn...",className:`bg-slate-950/50 border ${x==="error"?"border-red-500":x==="success"?"border-green-500":"border-slate-700"} text-white px-4 py-3 rounded-xl focus:outline-none focus:border-blue-500 w-full md:w-64 transition-colors`,value:o,onChange:t=>{v(t.target.value),n("idle"),i("")},disabled:g}),e.jsx("button",{onClick:I,disabled:g||!o.trim(),className:"bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 disabled:cursor-not-allowed text-white text-invariant-white px-6 py-3 rounded-xl font-bold transition-colors whitespace-nowrap flex items-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"animate-spin",size:16}),"Đang xử lý..."]}):"Đăng ký"})]}),x==="error"&&e.jsxs("span",{className:"text-red-400 text-xs ml-1 flex items-center gap-1",children:[e.jsx(R,{size:12})," ",S||"Email không hợp lệ"]}),x==="success"&&e.jsxs("span",{className:"text-green-400 text-xs ml-1",children:["✓ ",S||"Đăng ký thành công!"]})]})]}),l&&e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-950/90 backdrop-blur-md animate-fade-in",onClick:()=>c(null)}),e.jsxs("div",{className:"bg-slate-900 rounded-3xl w-full max-w-4xl max-h-[90vh] overflow-y-auto relative z-10 border border-slate-700 shadow-2xl flex flex-col animate-fade-in-up",children:[e.jsx("button",{onClick:()=>c(null),className:"absolute top-4 right-4 z-20 p-2 bg-black/50 hover:bg-black/80 text-white rounded-full transition-colors backdrop-blur-md",children:e.jsx(V,{size:20})}),e.jsxs("div",{className:"w-full h-64 md:h-80 relative flex-shrink-0",children:[e.jsx("img",{src:l.imageUrl,alt:l.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-transparent"}),e.jsxs("div",{className:"absolute bottom-6 left-6 right-6",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-600 text-white text-xs font-bold rounded-full uppercase tracking-wider mb-3 inline-block shadow-lg",children:l.category==="event"?"Sự kiện":"Tin tức"}),e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white leading-tight shadow-sm text-shadow-md",children:l.title})]})]}),e.jsxs("div",{className:"p-6 md:p-10 space-y-6 bg-slate-900",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-800 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-6 text-sm text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-2 text-blue-400 font-medium",children:[e.jsx(C,{size:16})," ",l.author]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(p,{size:16})," ",l.date]})]}),l.url&&e.jsxs("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-slate-400 hover:text-white transition-colors",children:["Xem nguồn ",e.jsx(L,{size:14})]})]}),e.jsx("div",{className:"prose prose-invert prose-lg max-w-none",children:e.jsx("p",{className:"text-slate-300 leading-relaxed whitespace-pre-wrap",children:l.summary||"Nội dung bài viết này không có văn bản hoặc chỉ chứa hình ảnh/video. Vui lòng truy cập nguồn gốc để xem chi tiết."})}),e.jsx("div",{className:"pt-8 flex justify-center",children:l.url?e.jsxs("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",className:"px-8 py-3 bg-orange-600 hover:bg-orange-500 text-white text-invariant-white font-bold rounded-xl transition-all shadow-lg flex items-center gap-2",children:["Đọc bài gốc tại nguồn ",e.jsx(L,{size:18})]}):e.jsx("button",{onClick:()=>c(null),className:"px-8 py-3 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-xl transition-all",children:"Đóng"})})]})]})]})]})};export{H as default};
